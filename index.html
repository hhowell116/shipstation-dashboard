<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WEEKLY SHIPSTATION LEADERBOARD ‚Äî TV</title>
  <style>
    :root{
      --header-grad: linear-gradient(90deg,#0a5d42,#2d9c6f);
      --bg-start:#0f1720;
      --bg-end:#1b2730;
      --ft:#34a853;
      --pt:#4285f4;
      --wh:#f57c00;
      --gold:#ffd700;
      --silver:#c0c0c0;
      --bronze:#cd7f32;
      --row-light:#353b47;
      --row-dark:#2e343f;
      --card-bg: rgba(255,255,255,0.02);
      --text-on-card: #ffffff;
    }

    /* Base */
    html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:linear-gradient(180deg,var(--bg-start),var(--bg-end));color:var(--text-on-card);-webkit-font-smoothing:antialiased;}
    .wrap{width:98%;max-width:2200px;margin:14px auto;padding:14px;box-sizing:border-box;}

    /* Header */
    .header{display:flex;align-items:center;justify-content:center;padding:18px;border-radius:10px;background:var(--header-grad);box-shadow:0 8px 24px rgba(5,10,10,0.45);color:white;}
    .header-center{flex:1;text-align:center}
    .title{font-weight:800;letter-spacing:1.5px;font-size:48px;margin:0;padding:0;text-transform:uppercase}
    .meta{font-size:26px;color:rgba(255,255,255,0.95);margin-top:8px;font-weight:600}

    /* Boards grid */
    .boards{display:grid;grid-template-columns:repeat(3,1fr);gap:26px;margin-top:24px}
    .card{background:var(--card-bg);border-radius:12px;overflow:hidden;box-shadow:0 12px 40px rgba(0,0,0,0.6);display:flex;flex-direction:column;height:calc(100vh - 240px);min-height:600px;min-width:280px;}
    .card-head{padding:18px 16px;color:var(--text-on-card);font-weight:800;text-align:center;font-size:22px;letter-spacing:0.6px}
    .card-body{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:0;background:transparent}

    /* Table layout ‚Äî use auto so columns resize naturally, but control widths */
    table{width:100%;border-collapse:collapse;font-size:18px;table-layout:auto;color:var(--text-on-card);}
    thead th{padding:14px 12px;text-align:center;font-weight:800;color:var(--text-on-card);position:sticky;top:0;z-index:3;background:rgba(20,24,30,0.9);font-size:20px;}
    tbody{display:block;width:100%;overflow:hidden}
    tbody tr{display:table;width:100%;table-layout:fixed;color:var(--text-on-card);}
    td{padding:12px 12px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.04);vertical-align:middle;font-size:18px;overflow:visible;white-space:normal;word-break:break-word;}

    /* Column sizing: force small numeric columns to shrink first; employee grows */
    .col-rank{width:80px;min-width:64px;text-align:center;font-weight:800;font-size:22px}
    .col-prod,.col-orders,.col-avg{width:1%;white-space:nowrap;min-width:60px;max-width:160px;font-weight:700} /* shrink-first columns */
    .col-employee{
      width:auto;
      min-width:260px; /* ensure visibility on TVs */
      max-width:700px;
      text-align:left;
      padding-left:18px;
      padding-right:18px;
      font-size:20px;
      font-weight:700;
      white-space:normal;
      overflow-wrap:break-word;
      word-break:break-word;
      line-height:1.25;
      display:block;
    }

    /* row shading */
    tbody tr:nth-child(odd) td{background:var(--row-light)}
    tbody tr:nth-child(even) td{background:var(--row-dark)}

    /* medals */
    .medal-gold td{background:var(--gold) !important;color:#000;font-weight:800}
    .medal-silver td{background:var(--silver) !important;color:#000;font-weight:800}
    .medal-bronze td{background:var(--bronze) !important;color:#000;font-weight:800}

    /* responsive adjustments for TVs and large displays */
    @media (min-width:1600px){
      .title{font-size:64px}
      .meta{font-size:32px}
      .card{height:calc(100vh - 200px);min-height:720px}
      table{font-size:22px}
      thead th{font-size:24px;padding:16px 12px}
      td{font-size:20px;padding:14px 12px}
      .col-employee{min-width:320px;font-size:22px}
    }

    /* smaller screen fallbacks */
    @media (max-width:1200px){
      .boards{grid-template-columns:1fr}
      .card{height:600px;min-height:450px}
      .title{font-size:28px}
      .meta{font-size:16px}
      table{font-size:13px}
      td{padding:8px}
      .col-employee{min-width:120px;font-size:13px;padding-left:8px}
      .col-prod,.col-orders,.col-avg{min-width:56px}
    }

    /* mobile */
    @media (max-width:480px){
      .title{font-size:20px}
      .card{height:480px}
      thead th{font-size:12px}
      td{font-size:12px;padding:6px}
      .col-employee{min-width:80px;font-size:12px;padding-left:6px}
      .col-prod,.col-orders,.col-avg{min-width:48px}
    }

    /* Scroller */
    .scroll-wrapper{position:relative;flex:1;overflow:hidden}
    .scroll-content{position:absolute;left:0;right:0;top:0;will-change:transform}
    .scroll-content table{margin:0}
    .scroll-content tbody{display:block}
    .notice{grid-column:1/-1;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--text-on-card);text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header" role="banner">
      <div class="header-center">
        <div class="title">Weekly Shipstation Leaderboard</div>
        <div id="weekRange" class="meta">Week: loading‚Ä¶</div>
      </div>
    </div>

    <div id="boards" class="boards" aria-live="polite" style="margin-top:18px">
      <div class="notice">Loading data...</div>
    </div>
  </div>

<script>
// This script is the same parsing logic you had but now wraps employee names and ensures column sizing.
// It will render the three leaderboards from columns B-F, H-L, N-R of your Weekly Dashboard sheet.
(async function(){
  const SHEET_ID = '1HYfTADTvqpOMByLHcNPrgu8ahY58AZmdxaVgKbfQlMQ';
  const GID = '1113265790';
  const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

  function parseCSV(text){
    const rows = [];
    const lines = text.replace(/\r\n/g,'\n').split('\n');
    for(const line of lines){
      const row = [];
      let cur = '';
      let inQuotes = false;
      for(let i=0;i<line.length;i++){
        const ch = line[i];
        if(ch === '"' ){
          if(inQuotes && line[i+1] === '"'){ cur += '"'; i++; continue; }
          inQuotes = !inQuotes;
          continue;
        }
        if(ch === ',' && !inQuotes){
          row.push(cur);
          cur = '';
          continue;
        }
        cur += ch;
      }
      row.push(cur);
      rows.push(row);
    }
    return rows;
  }

  function nice(x){ if(!x) return ''; const n = Number(x.toString().replace(/[,]/g,'')); return Number.isFinite(n) ? n.toLocaleString() : x; }

  async function fetchCSV(){
    const res = await fetch(CSV_URL);
    if(!res.ok) throw new Error('Failed to load sheet ‚Äî make sure it is published. Status: '+res.status);
    const txt = await res.text();
    return parseCSV(txt);
  }

  function getMeta(grid){
    // row 1 title, row2 week, row3 last updated (based on your CSV)
    const weekRow = (grid[1] || []).join(' ').trim();
    const luRow = (grid[2] || []).join(' ').trim();
    return { week: weekRow, lastUpdated: luRow };
  }

  function extractRangeByCols(grid, startCol){
    const out = [];
    // header at row index 3 (0-based) per your CSV; data starts at row 4
    for(let r=4; r<grid.length; r++){
      const row = grid[r] || [];
      const rank = (row[startCol] || '').toString().trim();
      const employee = (row[startCol+1] || '').toString().trim();
      const products = (row[startCol+2] || '').toString().trim();
      const orders = (row[startCol+3] || '').toString().trim();
      const avg = (row[startCol+4] || '').toString().trim();
      if(!rank && !employee && !products && !orders && !avg) break;
      out.push({ rank, employee, products, orders, avg });
    }
    return out;
  }

  function buildCard(title,color,rows){
    const head = `<div class="card-head" style="background:${color}">üèÜ ${title.toUpperCase()} üèÜ</div>`;
    if(!rows || rows.length===0) return `<div class="card">${head}<div class="card-body"><div class="notice">No data for this week</div></div></div>`;
    const rowsHtml = rows.map((r,idx)=>{
      const cls = idx===0? 'medal-gold' : idx===1? 'medal-silver' : idx===2? 'medal-bronze' : '';
      const displayRank = idx < 3 ? ['ü•á','ü•à','ü•â'][idx] : (idx+1).toString();
      // wrap employee in a span so CSS can control breaking into multiple lines
      const empHtml = `<div class="emp-name">${r.employee || ''}</div>`;
      return `<tr class="${cls}"><td class="col-rank">${displayRank}</td><td class="col-employee">${empHtml}</td><td class="col-prod">${nice(r.products)}</td><td class="col-orders">${nice(r.orders)}</td><td class="col-avg">${r.avg||''}</td></tr>`;
    }).join('');
    return `
      <div class="card">
        ${head}
        <div class="card-body">
          <table aria-label="${title} leaderboard">
            <thead>
              <tr>
                <th class="col-rank">Rank</th>
                <th class="col-employee">Employee</th>
                <th class="col-prod">Products</th>
                <th class="col-orders">Orders</th>
                <th class="col-avg">Avg Item/Order</th>
              </tr>
            </thead>
          </table>
          <div class="scroll-wrapper" data-rows="${rows.length}" style="flex:1;position:relative">
            <div class="scroll-content" role="list" aria-label="${title} entries">
              <table><tbody>${rowsHtml}</tbody></table>
            </div>
          </div>
        </div>
      </div>`;
  }

  try{
    const grid = await fetchCSV();
    const meta = getMeta(grid);
    if(meta.week) document.getElementById('weekRange').textContent = meta.week;
    // build datasets from known columns: Full-time B=1, Part-time H=7, Wholesale N=13 (0-based)
    const ft = extractRangeByCols(grid, 1);
    const pt = extractRangeByCols(grid, 7);
    const wh = extractRangeByCols(grid, 13);
    const boards = document.getElementById('boards');
    boards.innerHTML = '';
    boards.insertAdjacentHTML('beforeend', buildCard('Full-time','var(--ft)',ft));
    boards.insertAdjacentHTML('beforeend', buildCard('Part-Time','var(--pt)',pt));
    boards.insertAdjacentHTML('beforeend', buildCard('Wholesale','var(--wh)',wh));

    // scrolling: duplicate and animate only if needed
    document.querySelectorAll('.scroll-wrapper').forEach(wrapper=>{
      const content = wrapper.querySelector('.scroll-content');
      const inner = content.querySelector('table');
      setTimeout(()=>{
        const contentH = inner.scrollHeight;
        const wrapH = wrapper.clientHeight;
        if(contentH > wrapH){
          content.innerHTML = content.innerHTML + content.innerHTML; // duplicate for loop
          let pos = 0;
          const speed = Math.max(18, Math.min(60, Math.floor(contentH/20))); // adapt speed to content size
          let direction = 1;
          let raf = null;
          let last = performance.now();
          let pauseUntil = 0;
          function step(now){
            if(now < pauseUntil){ raf = requestAnimationFrame(step); return; }
            const delta = now - last;
            last = now;
            pos += (speed * delta / 1000) * direction;
            const half = content.scrollHeight / 2;
            const maxPos = half - wrapH;
            if(pos >= maxPos){
              pos = maxPos; direction = -1; pauseUntil = now + 1500;
            } else if(pos <= 0){
              pos = 0; direction = 1; pauseUntil = now + 1500;
            }
            content.style.transform = `translateY(${-pos}px)`;
            raf = requestAnimationFrame(step);
          }
          raf = requestAnimationFrame(step);
          wrapper.addEventListener('mouseenter', ()=>{ if(raf) cancelAnimationFrame(raf); raf = null; });
          wrapper.addEventListener('mouseleave', ()=>{ if(!raf){ last = performance.now(); raf = requestAnimationFrame(step); } });
        } else {
          inner.style.marginTop = Math.max(0, (wrapper.clientHeight - contentH)/2) + 'px';
        }
      },120);
    });

  } catch(err){
    console.error(err);
    document.getElementById('boards').innerHTML = `<div class="notice">‚ö†Ô∏è Error loading data: ${err.message}. Make sure the Weekly Dashboard sheet is published (File ‚Üí Share ‚Üí Publish to web).</div>`;
  }
})();</script>
</body>
</html>
